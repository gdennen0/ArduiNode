/*
 * DMX Test - Same as before when it worked
 * Simple test pattern to verify DMX output
 */

#include <Arduino.h>
#include <DMXSerial.h>

#define DMX_CHANNELS 512
#define STATUS_LED 13
#define DMX_MASTER_PIN 2

unsigned long lastUpdate = 0;
int testMode = 0;

void setup() {
  pinMode(STATUS_LED, OUTPUT);
  
  // Set pin 2 HIGH for DMX Master mode
  pinMode(DMX_MASTER_PIN, OUTPUT);
  digitalWrite(DMX_MASTER_PIN, HIGH);
  
  delay(100);
  
  DMXSerial.init(DMXController);
  DMXSerial.maxChannel(DMX_CHANNELS);
  
  for (int i = 1; i <= DMX_CHANNELS; i++) {
    DMXSerial.write(i, 0);
  }
  
  for (int i = 0; i < 3; i++) {
    digitalWrite(STATUS_LED, HIGH);
    delay(100);
    digitalWrite(STATUS_LED, LOW);
    delay(100);
  }
}

void loop() {
  if (millis() - lastUpdate > 2000) {
    lastUpdate = millis();
    digitalWrite(STATUS_LED, HIGH);
    
    for (int i = 1; i <= DMX_CHANNELS; i++) {
      DMXSerial.write(i, 0);
    }
    
    switch (testMode) {
      case 0:
        break;
      case 1:
        for (int i = 1; i <= 5; i++) {
          DMXSerial.write(i, 255);
        }
        break;
      case 2:
        for (int i = 1; i <= 5; i++) {
          DMXSerial.write(i, 128);
        }
        break;
      case 3:
        DMXSerial.write(1, 255);
        DMXSerial.write(2, 200);
        DMXSerial.write(3, 150);
        DMXSerial.write(4, 100);
        DMXSerial.write(5, 50);
        break;
    }
    
    testMode = (testMode + 1) % 4;
    digitalWrite(STATUS_LED, LOW);
  }
  
  delay(10);
}

